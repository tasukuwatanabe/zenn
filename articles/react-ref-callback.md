---
title: "Reactã®refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§DOMè¦ç´ ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’å®Ÿè£…ã™ã‚‹"
emoji: "ğŸª"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['react', 'typescript']
published: false
publication_name: "hrbrain"
---

## ã¯ã˜ã‚ã«

ã“ã‚“ã«ã¡ã¯ã€‚HRBrainã§å­¦ç¿’ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹[ã€ŒHRBrain ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã€](https://www.hrbrain.jp/lms)ã‚’é–‹ç™ºã—ã¦ã„ã‚‹æ¸¡é‚‰ã§ã™ã€‚

æœ€è¿‘ã€å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹éš›ã«ã€å›°ã£ãŸå•é¡Œã«é­é‡ã—ã¾ã—ãŸã€‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã—ã¦ã‚‚ã€videoè¦ç´ ã®éŸ³å£°ãŒå†ç”Ÿã•ã‚Œç¶šã‘ã¾ã™ã€‚èª¿æŸ»ã—ã¦ã¿ã‚‹ã¨ã€DOMè¦ç´ ãŒç ´æ£„ã•ã‚Œã‚‹å‰ã«`pause()`ã‚’å‘¼ã³å‡ºã™å¿…è¦ãŒã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚

ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹éç¨‹ã§ã€ã€Œrefã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€ã¨ã„ã†æ‰‹æ³•ã«å‡ºä¼šã„ã¾ã—ãŸã€‚refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½¿ã†ã“ã¨ã§ã€videoè¦ç´ ã®ãƒã‚¦ãƒ³ãƒˆæ™‚ã¨ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆæ™‚ã®å‡¦ç†ã‚’ç°¡æ½”ã«æ›¸ãã“ã¨ãŒã§ãã€å•é¡Œã‚’è§£æ±ºã§ãã¾ã—ãŸã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«ã‚ˆã‚‹DOMè¦ç´ ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè£…ã¨ã€React 19ã§ã®å¤‰æ›´ç‚¹ã‚’è§£èª¬ã—ã¾ã™ã€‚

## refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã¯

refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ã€DOMè¦ç´ ãŒå‚ç…§ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸæ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°ã§ã™ã€‚`useRef`ã§ref objectã‚’ä½œæˆã™ã‚‹ä»£ã‚ã‚Šã«ã€é–¢æ•°ã‚’`ref`å±æ€§ã«æ¸¡ã™ã“ã¨ã§ä½¿ç”¨ã§ãã¾ã™ã€‚

```tsx
const MyComponent = () => {
    const handleRef = (element: HTMLDivElement | null) => {
        // refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå‘¼ã°ã‚Œã‚‹
    }

    return <div ref={handleRef}>Hello</div>
}
```

refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ä»¥ä¸‹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚

- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã€DOMè¦ç´ ãŒä½œæˆã•ã‚ŒãŸã¨ã â†’ å¼•æ•°ã«`element`ãŒæ¸¡ã•ã‚Œã‚‹
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã¨ã â†’ å¼•æ•°ã«`null`ãŒæ¸¡ã•ã‚Œã‚‹

:::message
**React 19ã§ã®å¤‰æ›´ç‚¹**
ä¸Šè¨˜ã®å‹•ä½œã¯React 18ã¾ã§ã®ä»•æ§˜ã§ã™ã€‚React 19ã§ã¯ã€refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‹ã‚‰`useEffect`ã¨åŒæ§˜ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã‚’è¿”ã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã®å ´åˆã€ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆæ™‚ã«`null`ãŒæ¸¡ã•ã‚Œã‚‹ä»£ã‚ã‚Šã«ã€è¿”ã—ãŸã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚è©³ç´°ã¯ã€ŒReact 19ã§ã®refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®å¤‰æ›´ç‚¹ã€ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
:::

ã“ã®ä»•çµ„ã¿ã‚’ä½¿ã†ã“ã¨ã§ã€DOMè¦ç´ ãŒåˆ©ç”¨å¯èƒ½ã«ãªã£ãŸç¬é–“ã«å‡¦ç†ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

## videoè¦ç´ ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè£…

### å•é¡Œï¼švideoè¦ç´ ã®éŸ³å£°ãŒæ­¢ã¾ã‚‰ãªã„

videoè¦ç´ ã‚’ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã—ã¦ã‚‚éŸ³å£°ãŒå†ç”Ÿã•ã‚Œç¶šã‘ã¦ã—ã¾ã†å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ã“ã®å•é¡Œã¯ã€videoè¦ç´ ãŒç ´æ£„ã•ã‚Œã‚‹å‰ã«`pause()`ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§è§£æ±ºã§ãã¾ã™ã€‚

### ãªãœuseEffectã§ã¯ã†ã¾ãã„ã‹ãªã„ã®ã‹

æœ€åˆã«`useEffect`ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã‚’ä½¿ã£ãŸå®Ÿè£…ã‚’è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```tsx
import { useRef, useEffect, useState } from 'react'

const VideoPlayerWithUseEffect = () => {
    const [showVideo, setShowVideo] = useState(true)
    const videoRef = useRef<HTMLVideoElement>(null)

    useEffect(() => {
        const videoElement = videoRef.current
        
        // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°
        return () => {
            if (videoElement) {
                videoElement.pause()
            }
        }
    }, [])

    return (
        <div>
            <button onClick={() => setShowVideo(!showVideo)}>
                {showVideo ? 'å‹•ç”»ã‚’éè¡¨ç¤º' : 'å‹•ç”»ã‚’è¡¨ç¤º'}
            </button>
            {showVideo && (
                <video ref={videoRef} controls src="/sample-video.mp4" />
            )}
        </div>
    )
}
```

ã“ã®å®Ÿè£…ã«ã¯å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚`useEffect`ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ã€**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…¨ä½“ãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹æ™‚**ã§ã™ã€‚ã—ã‹ã—ã€ã“ã®ã‚±ãƒ¼ã‚¹ã§ã¯`{showVideo && <video ... />}`ã¨ã„ã†æ¡ä»¶ä»˜ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã«ã‚ˆã‚Šã€**videoè¦ç´ ã ã‘ãŒDOMã‹ã‚‰å‰Šé™¤ã•ã‚Œã‚‹**ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§éŸ³å£°ã‚’åœæ­¢ã—ãŸã„ã®ã§ã™ã€‚

ã¤ã¾ã‚Šã€videoè¦ç´ ãŒDOMã‹ã‚‰å‰Šé™¤ã•ã‚Œã¦ã‚‚ã€è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã¾ã ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã¾ã¾ãªã®ã§ã€`useEffect`ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã¯å‘¼ã°ã‚Œã¾ã›ã‚“ã€‚çµæœã¨ã—ã¦ã€éŸ³å£°ãŒå†ç”Ÿã•ã‚Œç¶šã‘ã¦ã—ã¾ã„ã¾ã™ã€‚

### refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½¿ã£ãŸå®Ÿè£…

refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ã€**è¦ç´ è‡ªä½“ã®ãƒã‚¦ãƒ³ãƒˆ/ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã«ç›´æ¥åå¿œ**ã™ã‚‹ãŸã‚ã€ã“ã®å•é¡Œã‚’è§£æ±ºã§ãã¾ã™ã€‚

```tsx
import { useState, useRef } from 'react'

const VideoPlayer = () => {
    const [showVideo, setShowVideo] = useState(true)
    const videoElementRef = useRef<HTMLVideoElement | null>(null)

    const videoRef = (element: HTMLVideoElement | null) => {
        if (element) {
            // videoè¦ç´ ãŒãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸæ™‚ã®å‡¦ç†
            videoElementRef.current = element
        } else {
            // videoè¦ç´ ãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹æ™‚ã®å‡¦ç†
            if (videoElementRef.current) {
                videoElementRef.current.pause()
                videoElementRef.current = null
            }
        }
    }

    return (
        <div>
            <button onClick={() => setShowVideo(!showVideo)}>
                {showVideo ? 'å‹•ç”»ã‚’éè¡¨ç¤º' : 'å‹•ç”»ã‚’è¡¨ç¤º'}
            </button>
            {showVideo && (
                <video
                    ref={videoRef}
                    controls
                    style={{ width: '400px' }}
                    src="/sample-video.mp4"
                />
            )}
        </div>
    )
}
```

ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€videoè¦ç´ ãŒDOMã‹ã‚‰å‰Šé™¤ã•ã‚Œã‚‹ç›´å‰ã«ç¢ºå®Ÿã«`pause()`ãŒå‘¼ã³å‡ºã•ã‚Œã€éŸ³å£°ãŒåœæ­¢ã—ã¾ã™ã€‚

:::message alert
**ãªãœuseRefãŒå¿…è¦ãªã®ã‹**
React 18ã¾ã§ã®ä»•æ§˜ã§ã¯ã€refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆæ™‚ã«`null`ãŒæ¸¡ã•ã‚Œã¾ã™ã€‚ãã®ãŸã‚ã€ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆæ™‚ã«è¦ç´ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€ãƒã‚¦ãƒ³ãƒˆæ™‚ã«`useRef`ã§è¦ç´ ã‚’ä¿å­˜ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚React 19ã§ã¯ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã‚’è¿”ã™ã“ã¨ã§ã“ã®å•é¡ŒãŒè§£æ±ºã•ã‚Œã¾ã™ï¼ˆå¾Œè¿°ï¼‰ã€‚
:::

## React 19ã§ã®refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®å¤‰æ›´ç‚¹

React 19ã§ã¯ã€refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®å‹•ä½œãŒæ”¹å–„ã•ã‚Œã¾ã—ãŸã€‚æœ€ã‚‚å¤§ããªå¤‰æ›´ã¯ã€**ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã‚’è¿”ã›ã‚‹**ã‚ˆã†ã«ãªã£ãŸã“ã¨ã§ã™ã€‚

ã“ã®æ©Ÿèƒ½ã«ã‚ˆã‚Šã€`useRef`ã‚’ä½¿ã‚ãšã«ã‚ˆã‚Šç°¡æ½”ãªã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‘ã¾ã™ã€‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°å†…ã§ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚’åˆ©ç”¨ã—ã¦`element`ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãŸã‚ã€React 18ã®ã‚ˆã†ã«è¦ç´ ã‚’ä¿å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

```tsx
// React 19ã®æ–°æ©Ÿèƒ½: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã‚’è¿”ã™
const VideoPlayer = () => {
    const [showVideo, setShowVideo] = useState(true)

    const videoRef = (element: HTMLVideoElement | null) => {
        if (element) {
            // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã‚’è¿”ã›ã‚‹
            return () => {
                element.pause()
            }
        }
    }

    return (
        <div>
            <button onClick={() => setShowVideo(!showVideo)}>
                {showVideo ? 'å‹•ç”»ã‚’éè¡¨ç¤º' : 'å‹•ç”»ã‚’è¡¨ç¤º'}
            </button>
            {showVideo && (
                <video ref={videoRef} controls src="/sample-video.mp4" />
            )}
        </div>
    )
}
```

## ã¾ã¨ã‚

ã“ã®è¨˜äº‹ã§ã¯ã€Reactã®refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½¿ã£ãŸDOMè¦ç´ ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ–¹æ³•ã¨ã€React 19ã§ã®å¤‰æ›´ç‚¹ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã—ãŸã€‚

- refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ã€DOMè¦ç´ ãŒãƒã‚¦ãƒ³ãƒˆ/ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸæ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°
- videoè¦ç´ ã®éŸ³å£°ãŒæ­¢ã¾ã‚‰ãªã„å•é¡Œã¯ã€refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§è§£æ±ºã§ãã‚‹
- useEffectã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…¨ä½“ã®ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆæ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€å€‹åˆ¥ã®è¦ç´ ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã«ã¯å‘ã‹ãªã„
- React 19ã§ã¯ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã‚’è¿”ã›ã‚‹æ–°æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã€useRefã‚’ä½¿ã‚ãšã«ã‚ˆã‚Šç°¡æ½”ãªã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‘ã‚‹

refã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½¿ã†ã“ã¨ã§ã€DOMè¦ç´ ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«ç´ã¥ã„ãŸã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†ã‚’ç°¡æ½”ã«è¨˜è¿°ã§ãã¾ã™ã€‚

### PR

æ ªå¼ä¼šç¤¾HRBrainã§ã¯ã€ä¸€ç·’ã«åƒãä»²é–“ã‚’å‹Ÿé›†ã—ã¦ã„ã¾ã™ï¼
èˆˆå‘³ã‚’æŒã£ã¦ã„ãŸã ã‘ãŸæ–¹ã¯ãœã²å¼Šç¤¾ã®æ¡ç”¨ãƒšãƒ¼ã‚¸ã‚’ã”ç¢ºèªãã ã•ã„ã€‚

https://www.hrbrain.co.jp/recruit

### å‚è€ƒè³‡æ–™

https://ja.react.dev/reference/react-dom/components/common#ref-callback
https://ja.react.dev/blog/2024/12/05/react-19#cleanup-functions-for-refs
https://ja.react.dev/learn/manipulating-the-dom-with-refs
https://qiita.com/uhyo/items/abacedd7d4b8370688c5
https://zenn.dev/uhyo/books/react-19-new/viewer/ref-cleanup
